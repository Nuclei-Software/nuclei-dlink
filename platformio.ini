; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter, extra scripting
;   Upload options: custom port, speed and extra flags
;   Library options: dependencies, extra library storages
;
; Please visit documentation for the other options and examples
; http://docs.platformio.org/page/projectconf.html

[platformio]
default_envs = gd32vf103c-start, sipeed-longan-nano, sipeed-longan-nano-alt
src_dir = .


[env]
platform = gd32v
;framework = gd32vf103-sdk
board = sipeed-longan-nano

; The target RV-Link is direcly connected to a host USB port

; Upload to the target RV-Link using USB DFU method of the built-in the bootloader
;upload_protocol = dfu

; Upload to the target RV-Link using the  stm32 (compatible) serial upload protocol of the built-in the bootloader
;upload_protocol = serial
;upload_port = /dev/ttyUSB0
;upload_speed = 115200

; Upload to the target RV-Link that is connected to another RV-Link
;upload_protocol = rv-link
;upload_port = /dev/serial/by-id/usb-RV-LINK_*-if00 ; aka /dev/ttyACM0
;debug_tool = rv-link
;debug_port = /dev/serial/by-id/usb-RV-LINK_*-if00 ; aka /dev/ttyACM0

; A serial monitor can be connected to a target USART e.g.:
; - USART0_NO_REMAP (TX0-PA9, RX0-PA10) of the JTAG header
; - USART2_NO_REMAP (TX2-B10, RX2-B11) of the pin header
;monitor_speed = 115200

; Monitor a target RV-Link USART connected to a generic USB-to-serial adapter
;monitor_port = /dev/ttyUSB0

; Monitor a target RV-Link USART connected to a FTDI FT232R USB-to-serial adapter
;monitor_port = /dev/serial/by-id/usb-FTDI_FT232R_USB_UART_*-if00-port0 ;  aka /dev/ttyUSB0

; Monitor a target RV-Link USART connected to another RV-Link
;monitor_port = /dev/serial/by-id/usb-RV-LINK_*61-if02 ; aka /dev/ttyACM1

extra_scripts =
    pre:scripts/platformio_pre_build.py
    post:scripts/platformio_post_script.py
src_filter =
    -<.git/> -<.svn/> -<example/> -<examples/> -<test/> -<tests/>
    +<lib/>
    +<rv-link/>
    -<rv-link/link/arch/gd32vf103c/>
    +<rv-link/link/arch/gd32vf103c/*.c>
    +<rv-link/link/arch/gd32vf103c/details/*.c>
build_flags =
    ; Add include path of the RV-Link project files
    -I.
    ; Add include path for the external libraries
    -Ilib
    ; Add include path specifically needed to build the gd32vf103-sdk library
    -Irv-link/link/arch/gd32vf103c
    -Ilib/gd32vf103-sdk/GD32VF103_standard_peripheral
    -Ilib/gd32vf103-sdk/GD32VF103_standard_peripheral/Include
    -Ilib/gd32vf103-sdk/GD32VF103_usbfs_driver/Include
    -Ilib/gd32vf103-sdk/RISCV/drivers
    ; Common GD32VD103 target defines for RV-Link
    -DGD32VF103C_START
    -D__SYSTEM_CLOCK_96M_PLL_HXTAL
    -DUSE_STDPERIPH_DRIVER
    -DUSE_USB_FS
    -DRVL_TARGET_GD32VF103
    -DRVL_DEBUG_EN
    -DRVL_ASSERT_EN
    -MMD
    ; Save intermediate assembler output
    ;-save-temps=obj
    ;-fverbose-asm
; Custom linker script
board_build.ldscript = lib/gd32vf103-sdk/RISCV/gcc/GD32VF103xB.lds


[env:gd32vf103c-start]
build_flags = ${env.build_flags}
    -DRVL_LINK_GD32VF103C_START
    -DRVL_SERIAL_USING_UART0_NO_REMAP
src_filter = ${env.src_filter}
    +<rv-link/link/arch/gd32vf103c/gd32vf103c-start/>


[env:sipeed-longan-nano]
build_flags = ${env.build_flags}
    -DRVL_LINK_LONGAN_NANO
    -DRVL_SERIAL_USING_UART0_NO_REMAP
src_filter = ${env.src_filter}
    +<rv-link/link/arch/gd32vf103c/longan-nano/>
; The Sipeed Longan Nano RV-Link is direcly connected to a host USB port
monitor_port = /dev/serial/by-id/usb-RV-LINK_Longan_Nano_*-if02 ; aka /dev/ttyACM1
monitor_speed = 115200

[env:sipeed-longan-nano-alt]
build_flags = ${env.build_flags}
    -DRVL_LINK_LONGAN_NANO_ALT
    -DRVL_SERIAL_USING_UART0_NO_REMAP
src_filter = ${env.src_filter}
    +<rv-link/link/arch/gd32vf103c/longan-nano-alt/>
    +<rv-link/link/arch/gd32vf103c/longan-nano/led.c>


[env:rvl-probe]
;framework = gd32vf103-sdk
build_flags = ${env.build_flags}
    -DRVL_LINK_RVL_PROBE
    -DRVL_SERIAL_USING_UART0_NO_REMAP
    -DRVL_PROBE_LINK_CONFIG_SPI0_NO_REMAP
src_filter = ${env.src_filter}
    +<rv-link/link/arch/gd32vf103c/rvl-probe/>
; The RVL-probe is connected to another Sipeed Longan Nano RV-Link
upload_protocol = rv-link
;upload_port = /dev/serial/by-id/usb-RV-LINK_Longan_Nano_*-if00 ; aka /dev/ttyACM0
debug_tool = rv-link
debug_port = /dev/serial/by-id/usb-RV-LINK_Longan_Nano_*-if00 ; aka /dev/ttyACM0
monitor_port = /dev/serial/by-id/usb-RV-LINK_Longan_Nano_*-if02 ; aka /dev/ttyACM1
monitor_speed = 115200
